#!/usr/bin/env sh
set -e

# Auto-sync docker-compose.prod.yml to production when it changes
# This runs after 'git pull' or 'git merge'

# Check if docker-compose.prod.yml was in the changed files (exact match)
if git diff-tree -r --name-only --no-commit-id ORIG_HEAD HEAD | grep -Fxq "infra/docker-compose.prod.yml"; then
  echo "[post-merge] docker-compose.prod.yml changed, syncing to production..."
  REPO_ROOT="$(git rev-parse --show-toplevel)"
  "$REPO_ROOT/scripts/deploy.sh" --recreate
fi
